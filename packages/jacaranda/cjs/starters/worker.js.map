{"version":3,"sources":["../../src/starters/worker.js"],"sourcesContent":["import App from '../App';\n\n/**\n * Start a worker app\n * @param {Function} worker\n * @param {object} [workerOptions]\n * @property {string} [workerOptions.workerName]\n * @property {boolean} [workerOptions.dontStop] - Don't stop after worker done\n * @property {Function} [workerOptions.initializer]\n */\nasync function startWorker(worker, options) {\n    const { workerName, dontStop, initializer, uninitializer, throwOnError, verbose, ...appOptions } = options || {};\n\n    if (verbose) {\n        appOptions.logLevel = 'verbose';\n    }\n\n    // create an app instance with custom configuration\n    let app = new App(workerName || 'worker', appOptions);\n\n    try {\n        await app.start_();\n\n        if (initializer) {\n            await initializer(app);\n        }\n\n        const result = await worker(app);\n\n        if (dontStop) {\n            process.once('SIGINT', () => {\n                app.stop_();\n            });\n        } else {\n            await app.stop_();\n        }\n\n        if (uninitializer) {\n            await uninitializer();\n        }\n\n        return result;\n    } catch (error) {\n        if (throwOnError) {\n            throw error;\n        }\n\n        console.error(verbose ? error : error.message);\n\n        process.exit(1);\n    }\n}\n\nexport default startWorker;\n"],"names":["startWorker","worker","options","workerName","dontStop","initializer","uninitializer","throwOnError","verbose","appOptions","logLevel","app","App","start_","result","process","once","stop_","error","console","message","exit"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAqDA;;;eAAA;;;4DArDgB;;;;;;AAEhB;;;;;;;CAOC,GACD,eAAeA,YAAYC,MAAM,EAAEC,OAAO;IACtC,MAAM,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,WAAW,EAAEC,aAAa,EAAEC,YAAY,EAAEC,OAAO,EAAE,GAAGC,YAAY,GAAGP,WAAW,CAAC;IAE/G,IAAIM,SAAS;QACTC,WAAWC,QAAQ,GAAG;IAC1B;IAEA,mDAAmD;IACnD,IAAIC,MAAM,IAAIC,YAAG,CAACT,cAAc,UAAUM;IAE1C,IAAI;QACA,MAAME,IAAIE,MAAM;QAEhB,IAAIR,aAAa;YACb,MAAMA,YAAYM;QACtB;QAEA,MAAMG,SAAS,MAAMb,OAAOU;QAE5B,IAAIP,UAAU;YACVW,QAAQC,IAAI,CAAC,UAAU;gBACnBL,IAAIM,KAAK;YACb;QACJ,OAAO;YACH,MAAMN,IAAIM,KAAK;QACnB;QAEA,IAAIX,eAAe;YACf,MAAMA;QACV;QAEA,OAAOQ;IACX,EAAE,OAAOI,OAAO;QACZ,IAAIX,cAAc;YACd,MAAMW;QACV;QAEAC,QAAQD,KAAK,CAACV,UAAUU,QAAQA,MAAME,OAAO;QAE7CL,QAAQM,IAAI,CAAC;IACjB;AACJ;MAEA,WAAerB"}