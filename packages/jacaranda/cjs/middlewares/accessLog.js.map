{"version":3,"sources":["../../src/middlewares/accessLog.js"],"sourcesContent":["/**\n * Add access log for every http request\n * @module Middleware_AccessLog\n */\n\nexport default async (opt, app) => {\n    const { logger } = app.middlewareConfig(\n        opt ?? {},\n        {\n            schema: {\n                logger: { type: 'text', default: 'logger' },\n            },\n        },\n        'accessLog'\n    );\n\n    const pinoHttp = await app.tryRequire_('pino-http');\n\n    app.requireServices([logger], 'accessLog');\n\n    const pinoLogger = app.getService(logger);\n\n    const log = pinoHttp({ quietReqLogger: true, ...opt, logger: pinoLogger });\n\n    return (ctx, next) => {\n        log(ctx.req, ctx.res);\n        ctx.log = ctx.request.log = ctx.response.log = ctx.req.log;\n        return next();\n    };\n};\n"],"names":["opt","app","logger","middlewareConfig","schema","type","default","pinoHttp","tryRequire_","requireServices","pinoLogger","getService","log","quietReqLogger","ctx","next","req","res","request","response"],"mappings":"AAAA;;;CAGC;;;;+BAED;;;eAAA;;;MAAA,WAAe,OAAOA,KAAKC;IACvB,MAAM,EAAEC,MAAM,EAAE,GAAGD,IAAIE,gBAAgB,CACnCH,OAAO,CAAC,GACR;QACII,QAAQ;YACJF,QAAQ;gBAAEG,MAAM;gBAAQC,SAAS;YAAS;QAC9C;IACJ,GACA;IAGJ,MAAMC,WAAW,MAAMN,IAAIO,WAAW,CAAC;IAEvCP,IAAIQ,eAAe,CAAC;QAACP;KAAO,EAAE;IAE9B,MAAMQ,aAAaT,IAAIU,UAAU,CAACT;IAElC,MAAMU,MAAML,SAAS;QAAEM,gBAAgB;QAAM,GAAGb,GAAG;QAAEE,QAAQQ;IAAW;IAExE,OAAO,CAACI,KAAKC;QACTH,IAAIE,IAAIE,GAAG,EAAEF,IAAIG,GAAG;QACpBH,IAAIF,GAAG,GAAGE,IAAII,OAAO,CAACN,GAAG,GAAGE,IAAIK,QAAQ,CAACP,GAAG,GAAGE,IAAIE,GAAG,CAACJ,GAAG;QAC1D,OAAOG;IACX;AACJ"}