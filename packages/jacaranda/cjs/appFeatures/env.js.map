{"version":3,"sources":["../../src/appFeatures/env.js"],"sourcesContent":["/**\n * Enable app customized env variables\n * @module Feature_Env\n */\n\nimport Feature from '../Feature';\nimport runtime, { K_ENV } from '../runtime';\nimport { _ } from '@kitmi/utils';\nimport { InvalidConfiguration } from '@kitmi/types';\n\nexport default {\n    /**\n     * This feature is loaded at init stage\n     * @member {string}\n     */\n    stage: Feature.INIT,\n\n    /**\n     * Load the feature\n     * @param {App} app - The cli app module object\n     * @param {object} envSettings - Customized env settings\n     * @property {array} [envSettings.expose] - Expose env variables from process.env into runtime\n     * @property {object} [envSettings.add] - Add env variables\n     * @returns {void}\n     */\n    load_: function (app, envSettings, name) {\n        let { expose, add } = app.featureConfig(\n            envSettings,\n            {\n                schema: {\n                    expose: { type: 'array', optional: true },\n                    add: { type: 'object', optional: true },\n                },\n            },\n            name\n        );\n\n        //todo: encrypt sensitive env variables\n\n        expose = new Set(expose || []);\n        expose.add('NODE_ENV');\n        expose.add('STAGE_ENV');\n\n        if (add?.NODE_ENV) {\n            throw new InvalidConfiguration('NODE_ENV cannot be added', app, `${name}.add.NODE_ENV`);\n        }\n\n        const exposed = _.pick(process.env, Array.from(expose));\n        runtime.register(K_ENV, { ...exposed, ...add });\n    },\n};\n"],"names":["stage","Feature","INIT","load_","app","envSettings","name","expose","add","featureConfig","schema","type","optional","Set","NODE_ENV","InvalidConfiguration","exposed","_","pick","process","env","Array","from","runtime","register","K_ENV"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"AAAA;;;CAGC;;;;+BAOD;;;eAAA;;;gEALoB;iEACW;uBACb;uBACmB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAErC,WAAe;IACX;;;KAGC,GACDA,OAAOC,gBAAO,CAACC,IAAI;IAEnB;;;;;;;KAOC,GACDC,OAAO,SAAUC,GAAG,EAAEC,WAAW,EAAEC,IAAI;QACnC,IAAI,EAAEC,MAAM,EAAEC,GAAG,EAAE,GAAGJ,IAAIK,aAAa,CACnCJ,aACA;YACIK,QAAQ;gBACJH,QAAQ;oBAAEI,MAAM;oBAASC,UAAU;gBAAK;gBACxCJ,KAAK;oBAAEG,MAAM;oBAAUC,UAAU;gBAAK;YAC1C;QACJ,GACAN;QAGJ,uCAAuC;QAEvCC,SAAS,IAAIM,IAAIN,UAAU,EAAE;QAC7BA,OAAOC,GAAG,CAAC;QACXD,OAAOC,GAAG,CAAC;QAEX,IAAIA,KAAKM,UAAU;YACf,MAAM,IAAIC,2BAAoB,CAAC,4BAA4BX,KAAK,CAAC,EAAEE,KAAK,aAAa,CAAC;QAC1F;QAEA,MAAMU,UAAUC,QAAC,CAACC,IAAI,CAACC,QAAQC,GAAG,EAAEC,MAAMC,IAAI,CAACf;QAC/CgB,gBAAO,CAACC,QAAQ,CAACC,cAAK,EAAE;YAAE,GAAGT,OAAO;YAAE,GAAGR,GAAG;QAAC;IACjD;AACJ"}