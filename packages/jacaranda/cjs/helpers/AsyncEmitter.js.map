{"version":3,"sources":["../../src/helpers/AsyncEmitter.js"],"sourcesContent":["import { pushIntoBucket, batchAsync_ } from '@kitmi/utils';\n\nclass AsyncEmitter {\n    constructor() {\n        this._handlers = {};\n    }\n\n    on(event, handler) {\n        pushIntoBucket(this._handlers, event, { once: false, handler });\n        return this;\n    }\n\n    once(event, handler) {\n        pushIntoBucket(this._handlers, event, { once: true, handler });\n        return this;\n    }\n\n    off(event, handler) {\n        let handlers = this._handlers[event];\n        if (!handlers || handlers.length === 0) {\n            return this;\n        }\n\n        if (handler) {\n            let index = handlers.findIndex((item) => item.handler === handler);\n            if (index >= 0) {\n                handlers.splice(index, 1);\n            }\n        } else {\n            delete this._handlers[event];\n        }\n\n        return this;\n    }\n\n    allOff() {\n        this._handlers = {};\n        return this;\n    }\n\n    async emit_(event, ...args) {\n        let handlers = this._handlers[event];\n        if (!handlers || handlers.length === 0) {\n            return false;\n        }\n\n        const _handlers = [...handlers];\n        const filtered = handlers.filter((item) => !item.once);\n\n        if (filtered.length === 0) {\n            delete this._handlers[event];\n        } else {\n            this._handlers[event] = filtered;\n        }         \n\n        await batchAsync_(_handlers, (item) => item.handler(...args));\n\n        return true;\n    }\n}\n\nexport default AsyncEmitter;\n"],"names":["AsyncEmitter","on","event","handler","pushIntoBucket","_handlers","once","off","handlers","length","index","findIndex","item","splice","allOff","emit_","args","filtered","filter","batchAsync_","constructor"],"mappings":";;;;+BA6DA;;;eAAA;;;uBA7D4C;AAE5C,MAAMA;IAKFC,GAAGC,KAAK,EAAEC,OAAO,EAAE;QACfC,IAAAA,qBAAc,EAAC,IAAI,CAACC,SAAS,EAAEH,OAAO;YAAEI,MAAM;YAAOH;QAAQ;QAC7D,OAAO,IAAI;IACf;IAEAG,KAAKJ,KAAK,EAAEC,OAAO,EAAE;QACjBC,IAAAA,qBAAc,EAAC,IAAI,CAACC,SAAS,EAAEH,OAAO;YAAEI,MAAM;YAAMH;QAAQ;QAC5D,OAAO,IAAI;IACf;IAEAI,IAAIL,KAAK,EAAEC,OAAO,EAAE;QAChB,IAAIK,WAAW,IAAI,CAACH,SAAS,CAACH,MAAM;QACpC,IAAI,CAACM,YAAYA,SAASC,MAAM,KAAK,GAAG;YACpC,OAAO,IAAI;QACf;QAEA,IAAIN,SAAS;YACT,IAAIO,QAAQF,SAASG,SAAS,CAAC,CAACC,OAASA,KAAKT,OAAO,KAAKA;YAC1D,IAAIO,SAAS,GAAG;gBACZF,SAASK,MAAM,CAACH,OAAO;YAC3B;QACJ,OAAO;YACH,OAAO,IAAI,CAACL,SAAS,CAACH,MAAM;QAChC;QAEA,OAAO,IAAI;IACf;IAEAY,SAAS;QACL,IAAI,CAACT,SAAS,GAAG,CAAC;QAClB,OAAO,IAAI;IACf;IAEA,MAAMU,MAAMb,KAAK,EAAE,GAAGc,IAAI,EAAE;QACxB,IAAIR,WAAW,IAAI,CAACH,SAAS,CAACH,MAAM;QACpC,IAAI,CAACM,YAAYA,SAASC,MAAM,KAAK,GAAG;YACpC,OAAO;QACX;QAEA,MAAMJ,YAAY;eAAIG;SAAS;QAC/B,MAAMS,WAAWT,SAASU,MAAM,CAAC,CAACN,OAAS,CAACA,KAAKN,IAAI;QAErD,IAAIW,SAASR,MAAM,KAAK,GAAG;YACvB,OAAO,IAAI,CAACJ,SAAS,CAACH,MAAM;QAChC,OAAO;YACH,IAAI,CAACG,SAAS,CAACH,MAAM,GAAGe;QAC5B;QAEA,MAAME,IAAAA,kBAAW,EAACd,WAAW,CAACO,OAASA,KAAKT,OAAO,IAAIa;QAEvD,OAAO;IACX;IAvDAI,aAAc;QACV,IAAI,CAACf,SAAS,GAAG,CAAC;IACtB;AAsDJ;MAEA,WAAeL"}