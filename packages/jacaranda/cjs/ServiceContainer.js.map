{"version":3,"sources":["../src/ServiceContainer.js"],"sourcesContent":["import ConfigLoader, { JsonConfigProvider, YamlConfigProvider } from '@kitmi/config';\nimport { _, pushIntoBucket, eachAsync_, arrayToObject, esmCheck } from '@kitmi/utils';\nimport { fs, tryRequire as _tryRequire } from '@kitmi/sys';\nimport { InvalidConfiguration, ValidationError } from '@kitmi/types';\nimport { Types } from '@kitmi/validators/allSync';\nimport { TopoSort } from '@kitmi/algo';\n\nimport path from 'node:path';\n\nimport Feature from './Feature';\nimport defaultOpts from './defaultOpts';\nimport AsyncEmitter from './helpers/AsyncEmitter';\nimport { consoleLogger, makeLogger } from './logger';\n\nconst FILE_EXT = ['.js', '.mjs', '.cjs', '.ts'];\n\nconst configOverrider = (defConf, envConf) => {\n    const { serviceGroup: defServiceGroup, ..._def } = defConf ?? {};\n    const { serviceGroup: envServiceGroup, ..._env } = envConf ?? {};\n\n    const serviceGroup = {};\n\n    if (defServiceGroup || envServiceGroup) {\n        defServiceGroup &&\n            _.each(defServiceGroup, (servicesMap, serviceName) => {\n                serviceGroup[serviceName] = servicesMap;\n            });\n\n        envServiceGroup &&\n            _.each(envServiceGroup, (servicesMap, serviceName) => {\n                serviceGroup[serviceName] = {\n                    ...serviceGroup[serviceName],\n                    ...servicesMap,\n                };\n            });\n    }\n\n    const ret = {\n        ..._def,\n        ..._env,\n    };\n\n    if (!_.isEmpty(serviceGroup)) {\n        ret.serviceGroup = serviceGroup;\n    }\n\n    return ret;\n};\n\n/**\n * Service container class.\n * @class\n */\nclass ServiceContainer extends AsyncEmitter {\n    _loggerLog = (...args) => {\n        this.logger.log(...args);\n        return this;\n    };\n\n    logError = (error, message) => {\n        return this.logException('error', error, message);\n    };\n\n    logErrorAsWarning = (error, message) => {\n        return this.logException('warn', error, message);\n    };\n\n    /**\n     * @param {string} name - The name of the container instance.\n     * @param {object} [options] - Container options\n     * @property {string} [options.env] - Environment, default to process.env.NODE_ENV\n     * @property {string} [options.workingPath] - App's working path, default to process.cwd()\n     * @property {string} [options.configPath=\"conf\"] - App's config path, default to \"conf\" under workingPath\n     * @property {string} [options.configName=\"app\"] - App's config basename, default to \"app\"\n     * @property {string} [options.configType=\"json\"] - App's config type, default to \"json\"\n     * @property {string} [options.disableEnvAwareConfig=false] - Don't use environment-aware config\n     * @property {array} [options.allowedFeatures] - A list of enabled feature names\n     * @property {boolean} [options.loadConfigFromOptions=false] - Whether to load config from passed-in options\n     * @property {object} [options.config] - Config in options, used only when loadConfigFromOptions\n     */\n    constructor(name, options) {\n        super();\n\n        /**\n         * Name of the app\n         * @member {object}\n         **/\n        this.name = name;\n\n        /**\n         * App options\n         * @member {object}\n         */\n        this.options = {\n            ...defaultOpts,\n            ...options,\n        };\n\n        /**\n         * Environment flag\n         * @member {string}\n         */\n        this.env = this.options.env;\n\n        /**\n         * Working directory of this cli app\n         * @member {string}\n         */\n        this.workingPath = this.options.workingPath ? path.resolve(this.options.workingPath) : process.cwd();\n\n        /**\n         * Config path\n         * @member {string}\n         */\n        this.configPath = this.toAbsolutePath(this.options.configPath);\n\n        /**\n         * Source files path.\n         * @member {string}\n         **/\n        this.sourcePath = this.toAbsolutePath(this.options.sourcePath);\n\n        /**\n         * Feature path\n         */\n        this.featuresPath = path.resolve(this.sourcePath, this.options.featuresPath);\n\n        this._logCache = [];\n\n        // dummy\n        this.log = (...args) => {\n            this._logCache.push(args);\n            return this;\n        };\n    }\n\n    /**\n     * Start the container.\n     * @fires ServiceContainer#configLoaded\n     * @fires ServiceContainer#ready\n     * @returns {Promise.<ServiceContainer>}\n     */\n    async start_() {\n        this.log('verbose', `Starting app [${this.name}] ...`);\n\n        await this.emit_('starting', this);\n\n        this._featureRegistry = {\n            //firstly look up \"features\" under current working path, and then try the builtin features path\n            '*': this._getFeatureFallbackPath(),\n        };\n\n        /**\n         * Loaded features, name => feature object\n         * @member {object}\n         */\n        this.features = {};\n\n        /**\n         * Loaded services\n         * @member {object}\n         */\n        this.services = {};\n\n        if (this.options.loadConfigFromOptions) {\n            this.config = this.options.config;\n        } else {\n            let configLoader;\n\n            if (this.options.configType === 'yaml') {\n                configLoader = this.options.disableEnvAwareConfig\n                    ? new ConfigLoader(\n                          new YamlConfigProvider(path.join(this.configPath, this.options.configName + '.yaml')),\n                          this\n                      )\n                    : ConfigLoader.createEnvAwareYamlLoader(\n                          this.configPath,\n                          this.options.configName,\n                          this.env,\n                          this,\n                          configOverrider\n                      );\n            } else {\n                configLoader = this.options.disableEnvAwareConfig\n                    ? new ConfigLoader(\n                          new JsonConfigProvider(path.join(this.configPath, this.options.configName + '.json')),\n                          this\n                      )\n                    : ConfigLoader.createEnvAwareJsonLoader(\n                          this.configPath,\n                          this.options.configName,\n                          this.env,\n                          this,\n                          configOverrider\n                      );\n            }\n\n            /**\n             * Configuration loader instance\n             * @member {ConfigLoader}\n             */\n            this.configLoader = configLoader;\n\n            await this.loadConfig_();\n        }\n\n        /**\n         * Config loaded event.\n         * @event ServiceContainer#configLoaded\n         */\n        await this.emit_('configLoaded', this.config);\n\n        if (!_.isEmpty(this.config)) {\n            await this._loadFeatures_();\n        } else {            \n            this.log('verbose', `Empty configuration! Config path: ${this.configPath}`);\n            this.flushLogCache();\n        }\n\n        /**\n         * App ready\n         * @event ServiceContainer#ready\n         */\n        await this.emit_('ready', this);\n\n        /**\n         * Flag showing the app is started or not.\n         * @member {bool}\n         */\n        this.started = true;\n\n        return this;\n    }\n\n    /**\n     * Stop the container\n     * @fires ServiceContainer#stopping\n     * @returns {Promise.<ServiceContainer>}\n     */\n    async stop_() {\n        /**\n         * App stopping\n         * @event ServiceContainer#stopping\n         */\n        await this.emit_('stopping', this);\n\n        this.log('verbose', `Stopping app [${this.name}] ...`);\n\n        this.started = false;\n\n        delete this.services;\n        delete this.features;\n        delete this._featureRegistry;\n\n        delete this.config;\n        delete this.configLoader;\n\n        await this.emit_('stopped', this);\n\n        this.allOff();\n    }\n\n    /**\n     * @returns {ServiceContainer}\n     */\n    async loadConfig_() {\n        let configVariables = this._getConfigVariables();\n\n        /**\n         * App configuration\n         * @member {object}\n         */\n        this.config = await this.configLoader.load_(configVariables);\n\n        return this;\n    }\n\n    /**\n     * Translate a relative path of this app module to an absolute path\n     * @param {array} args - Array of path parts\n     * @returns {string}\n     */\n    toAbsolutePath(...args) {\n        args = args.filter((arg) => arg != null);\n        if (args.length === 0) {\n            return this.workingPath;\n        }\n\n        return path.resolve(this.workingPath, ...args);\n    }\n\n    tryRequire(pkgName, local) {\n        const obj = local ? require(pkgName) : _tryRequire(pkgName, this.workingPath);\n        return esmCheck(obj);\n    }\n\n    /**\n     * Try to require a package, if it's an esm module, import it.\n     * @param {*} pkgName\n     * @param {*} useDefault\n     * @returns {*} \n     */\n    async tryRequire_(pkgName, useDefault) {\n        try {\n            return this.tryRequire(pkgName);\n        } catch (error) {\n            if (error.code === 'ERR_REQUIRE_ESM') {\n                const esmModule = await import(pkgName);\n                if (useDefault) {\n                    return esmModule.default;\n                }\n                return esmModule;\n            }\n            throw error;\n        }\n    }\n\n    /**\n     * Register a service\n     * @param {string} name\n     * @param {object} serviceObject\n     * @param {boolean} override\n     * @returns {ServiceContainer}\n     */\n    registerService(name, serviceObject, override) {\n        if (name in this.services && !override) {\n            throw new Error('Service \"' + name + '\" already registered!');\n        }\n\n        this.services[name] = serviceObject;\n        this.log('verbose', `Service \"${name}\" registered.`);\n        return this;\n    }\n\n    /**\n     * Check whether a service exists\n     * @param {*} name\n     * @returns {boolean}\n     */\n    hasService(name) {\n        return name in this.services;\n    }\n\n    /**\n     * Get a service from module hierarchy\n     * @param name\n     * @returns {object}\n     */\n    getService(name) {\n        return this.services[name];\n    }\n\n    /**\n     * Check whether a feature is enabled in the app.\n     * @param {string} feature\n     * @returns {bool}\n     */\n    enabled(feature) {\n        return this.features[feature]?.enabled || this.host?.enabled(feature) || false;\n    }\n\n    /**\n     * Add more or overide current feature registry\n     * @param {object} registry\n     */\n    addFeatureRegistry(registry) {\n        // * is used as the fallback location to find a feature\n        if (registry.hasOwnProperty('*')) {\n            pushIntoBucket(this._featureRegistry, '*', registry['*']);\n        }\n\n        Object.assign(this._featureRegistry, _.omit(registry, ['*']));\n    }\n\n    /**\n     * Helper method to log an exception\n     * @param {*} level\n     * @param {*} error\n     * @param {*} summary\n     * @returns {ServiceContainer}\n     */\n    logException(level, error, summary) {\n        this.log(\n            level,\n            (summary ? summary + '\\n' : '') + error.message,\n            _.pick(error, ['name', 'status', 'code', 'info', 'stack', 'request'])\n        );\n        return this;\n    }\n\n    trace(...args) {\n        return this.log('trace', ...args);\n    }\n\n    debug(...args) {\n        return this.log('debug', ...args);\n    }\n\n    verbose(...args) {\n        return this.log('verbose', ...args);\n    }\n\n    info(...args) {\n        return this.log('info', ...args);\n    }\n\n    warn(...args) {\n        return this.log('warn', ...args);\n    }\n\n    error(...args) {\n        return this.log('error', ...args);\n    }\n\n    featureConfig(config, typeInfo, name) {\n        return this.sanitize(config, typeInfo, name);\n    }\n\n    sanitize(config, typeInfo, name, category) {\n        try {\n            return Types.OBJECT.sanitize(config, { type: 'object', ...typeInfo }, this.i18n, name);\n        } catch (err) {\n            let message;\n\n            if (err instanceof ValidationError) {\n                message = ValidationError.formatError(err);\n            } else {\n                message = err.message;\n            }\n            throw new InvalidConfiguration(message, this, category ? `${category}::${name}` : name);\n        }\n    }\n\n    _getConfigVariables() {\n        const processInfo = {\n            env: process.env,\n            arch: process.arch, // The operating system CPU architectureï¼Œ 'arm', 'arm64','x64', ...\n            argv: process.argv,\n            cwd: process.cwd(),\n            pid: process.pid,\n            platform: process.platform,\n        };\n\n        return {\n            app: this,\n            env: this.env,\n            process: processInfo,\n        };\n    }\n\n    _getFeatureFallbackPath() {\n        return [path.resolve(__dirname, 'features'), this.featuresPath];\n    }\n\n    _sortFeatures(features) {\n        if (features.length === 0) {\n            return features;\n        }\n\n        const topoSort = new TopoSort();\n        features.forEach(([feature]) => {\n            topoSort.depends(feature.name, feature.depends);\n        });\n\n        const groups = arrayToObject(features, ([feature]) => feature.name);\n        const keys = topoSort.sort();\n\n        const sorted = [];\n        keys.forEach((key) => {\n            const feature = groups[key];\n            if (feature) {\n                sorted.push(feature);\n            } else {\n                if (!this.enabled(key)) {\n                    throw new InvalidConfiguration(`A prerequisite feature \"${key}\" is not enabled.`, this);\n                }\n            }\n        });\n\n        return sorted;\n    }\n\n    flushLogCache() {\n        if (this.runnable && !('logger' in this.config)) {\n            const _makeLogger = (logLevel, channel) => ({\n                log: makeLogger(consoleLogger, logLevel, channel),\n                child: (arg1, arg2) => _makeLogger(arg2?.level || logLevel, arg1?.module),\n            });\n            this.logger = _makeLogger(this.options.logLevel);\n            this.log = this._loggerLog;\n            this._logCache.forEach((log) => this.logger.log(...log));\n            this._logCache.length = 0;\n        }\n    }\n\n    /**\n     * Load features\n     * @private\n     * @returns {bool}\n     */\n    async _loadFeatures_() {\n        try {\n            // run config stage separately first\n            let configStageFeatures = [];\n\n            // load features\n            _.each(this.config, (featureOptions, name) => {\n                if (this.options.allowedFeatures && this.options.allowedFeatures.indexOf(name) === -1) {\n                    //skip disabled features\n                    return;\n                }\n\n                if (this.options.ignoreFeatures && this.options.ignoreFeatures.indexOf(name) !== -1) {\n                    //ignore features, useful for worker to use the same config with server\n                    return;\n                }\n\n                let feature;\n                try {\n                    feature = this._loadFeature(name);\n                } catch (err) {\n                    //ignore the first trial\n                    //this.log('warn', err.message, { err });\n                }\n\n                if (feature && feature.stage === Feature.CONF) {\n                    configStageFeatures.push([feature, featureOptions]);\n                    delete this.config[name];\n                }\n            });\n\n            if (configStageFeatures.length > 0) {\n                await this._loadFeatureGroup_(configStageFeatures, Feature.CONF);\n\n                //reload all features if any type of configuration feature exists\n                return this._loadFeatures_();\n            }\n        } finally {\n            // if no logger in config, use console logger\n            this.flushLogCache();\n        }\n\n        await this.emit_('configFinalized', this.config);\n\n        if (this.options.logConfig && (this.options.logLevel === 'debug' || this.options.logLevel === 'verbose')) {\n            this.log('verbose', 'Finalized config:', this.config);\n        }\n\n        let featureGroups = {\n            [Feature.INIT]: [],\n            [Feature.SERVICE]: [],\n            [Feature.PLUGIN]: [],\n            [Feature.FINAL]: [],\n        };\n\n        // load features\n        _.each(this.config, (featureOptions, name) => {\n            if (this.options.allowedFeatures && this.options.allowedFeatures.indexOf(name) === -1) {\n                //skip disabled features\n                return;\n            }\n\n            let feature = this._loadFeature(name);\n\n            if (!(feature.stage in featureGroups)) {\n                throw new Error(`Invalid feature stage. Feature: ${name}, type: ${feature.stage}`);\n            }\n\n            featureGroups[feature.stage].push([feature, featureOptions]);\n        });\n\n        return eachAsync_(featureGroups, (group, stage) => this._loadFeatureGroup_(group, stage));\n    }\n\n    async _loadFeatureGroup_(featureGroup, groupStage) {\n        featureGroup = this._sortFeatures(featureGroup);\n\n        await this.emit_('before:' + groupStage);\n        this.log('verbose', `Loading \"${groupStage}\" feature group ...`);\n\n        await eachAsync_(featureGroup, async ([feature, options]) => {\n            const { name, depends } = feature;\n            await this.emit_('before:load:' + name);\n            this.log('verbose', `Loading feature \"${name}\" ...`);\n\n            depends && this._dependsOn(depends, name);\n\n            await feature.load_(this, options, name);\n            this.features[name].enabled = true;\n            this.log('verbose', `Feature \"${name}\" loaded. [OK]`);\n\n            await this.emit_('after:load:' + name);\n        });\n        this.log('verbose', `Finished loading \"${groupStage}\" feature group. [OK]`);\n\n        await this.emit_('after:' + groupStage);\n    }\n\n    _dependsOn(features, fromFeature) {\n        let hasNotEnabled = _.find(_.castArray(features), (feature) => !this.enabled(feature));\n\n        if (hasNotEnabled) {\n            throw new Error(`The \"${hasNotEnabled}\" feature depended by \"${fromFeature}\" feature is not enabled.`);\n        }\n    }\n\n    /**\n     * Load a feature object by name.\n     * @private\n     * @param {string} feature\n     * @returns {object}\n     */\n    _loadFeature(feature) {\n        let featureObject = this.features[feature];\n        if (featureObject) return featureObject;\n\n        let featurePath;\n\n        if (this._featureRegistry.hasOwnProperty(feature)) {\n            //load by registry entry\n            let loadOption = this._featureRegistry[feature];\n\n            if (Array.isArray(loadOption)) {\n                if (loadOption.length === 0) {\n                    throw new Error(`Invalid registry value for feature \"${feature}\".`);\n                }\n\n                featurePath = loadOption[0];\n                featureObject = this.tryRequire(featurePath);\n\n                if (loadOption.length > 1) {\n                    //one module may contains more than one feature\n                    featureObject = _.get(featureObject, loadOption[1]);\n                }\n            } else {\n                featurePath = loadOption;\n                featureObject = this.tryRequire(featurePath);\n            }\n        } else {\n            //load by fallback paths\n            let searchingPath = this._featureRegistry['*'];\n\n            //reverse fallback stack\n            let found = _.findLast(searchingPath, (p) =>\n                FILE_EXT.find((ext) => {\n                    featurePath = path.join(p, feature + ext);\n                    return fs.existsSync(featurePath);\n                })\n            );\n\n            if (!found) {\n                throw new InvalidConfiguration(`Don't know where to load feature \"${feature}\".`, this, {\n                    feature,\n                    searchingPath,\n                });\n            }\n\n            featureObject = this.tryRequire(featurePath);\n        }        \n\n        featureObject = typeof featureObject === 'function' ? featureObject(this) : featureObject;\n\n        if (!Feature.validate(featureObject)) {\n            throw new Error(`Invalid feature object loaded from \"${featurePath}\".`);\n        }\n\n        if (!featureObject.stage) {\n            featureObject.stage = Feature.SERVICE;\n        }\n\n        featureObject.name = feature;\n        this.features[feature] = featureObject;\n        return featureObject;\n    }\n}\n\nexport default ServiceContainer;\n"],"names":["FILE_EXT","configOverrider","defConf","envConf","serviceGroup","defServiceGroup","_def","envServiceGroup","_env","_","each","servicesMap","serviceName","ret","isEmpty","ServiceContainer","AsyncEmitter","start_","log","name","emit_","_featureRegistry","_getFeatureFallbackPath","features","services","options","loadConfigFromOptions","config","configLoader","configType","disableEnvAwareConfig","ConfigLoader","YamlConfigProvider","path","join","configPath","configName","createEnvAwareYamlLoader","env","JsonConfigProvider","createEnvAwareJsonLoader","loadConfig_","_loadFeatures_","flushLogCache","started","stop_","allOff","configVariables","_getConfigVariables","load_","toAbsolutePath","args","filter","arg","length","workingPath","resolve","tryRequire","pkgName","local","obj","require","_tryRequire","esmCheck","tryRequire_","useDefault","error","code","esmModule","default","registerService","serviceObject","override","Error","hasService","getService","enabled","feature","host","addFeatureRegistry","registry","hasOwnProperty","pushIntoBucket","Object","assign","omit","logException","level","summary","message","pick","trace","debug","verbose","info","warn","featureConfig","typeInfo","sanitize","category","Types","OBJECT","type","i18n","err","ValidationError","formatError","InvalidConfiguration","processInfo","process","arch","argv","cwd","pid","platform","app","__dirname","featuresPath","_sortFeatures","topoSort","TopoSort","forEach","depends","groups","arrayToObject","keys","sort","sorted","key","push","runnable","_makeLogger","logLevel","channel","makeLogger","consoleLogger","child","arg1","arg2","module","logger","_loggerLog","_logCache","configStageFeatures","featureOptions","allowedFeatures","indexOf","ignoreFeatures","_loadFeature","stage","Feature","CONF","_loadFeatureGroup_","logConfig","featureGroups","INIT","SERVICE","PLUGIN","FINAL","eachAsync_","group","featureGroup","groupStage","_dependsOn","fromFeature","hasNotEnabled","find","castArray","featureObject","featurePath","loadOption","Array","isArray","get","searchingPath","found","findLast","p","ext","fs","existsSync","validate","constructor","logError","logErrorAsWarning","defaultOpts","sourcePath"],"mappings":"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"}