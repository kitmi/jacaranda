{"version":3,"sources":["../src/ServiceInstaller.js"],"sourcesContent":["import { packageManagers } from '@kitmi/adapters';\nimport { eachAsync_ } from '@kitmi/utils';\nimport ServiceContainer from './ServiceContainer';\n\n/**\n * Service dependencies installer.\n * @class\n */\nclass ServiceInstaller extends ServiceContainer {     \n    async _loadFeatureGroup_(featureGroup, groupStage) {\n        const npm = packageManagers[this.options.packageManager];\n\n        featureGroup = this._sortFeatures(featureGroup);\n\n        await this.emit_('before:' + groupStage);\n        this.log('verbose', `Installing dependencies for \"${groupStage}\" feature group ...`);\n\n        let counter = 0;\n\n        await eachAsync_(featureGroup, async ([feature]) => {\n            const { name, depends } = feature;\n            await this.emit_('before:load:' + name);\n            this.log('verbose', `Installing dependencies for feature \"${name}\" ...`);\n\n            depends && this._dependsOn(depends, name);\n\n            const requiredPackages = feature.packages ?? [];\n            await eachAsync_(requiredPackages, pkg => npm.addPackage_(pkg));\n\n            this.features[name].enabled = true;\n            if (requiredPackages.length > 0) {\n                this.log('verbose', `Dependencies of feature \"${name}\" are installed. [${requiredPackages.length}]`);\n            } else {\n                this.log('verbose', `No dependencies found for feature \"${name}\". [SKIP]`);\n            }\n\n            await this.emit_('after:load:' + name);\n\n            counter += requiredPackages.length;\n        });\n\n        if (counter > 0) {\n            this.log('verbose', `Finished installation of dependencies for \"${groupStage}\" feature group. [${counter}]`);\n        } else {\n            this.log('verbose', `No dependencies found for \"${groupStage}\" feature group. [SKIP]`);\n        }\n\n        await this.emit_('after:' + groupStage);\n    }\n}\n\nexport default ServiceInstaller;\n"],"names":["ServiceInstaller","ServiceContainer","_loadFeatureGroup_","featureGroup","groupStage","npm","packageManagers","options","packageManager","_sortFeatures","emit_","log","counter","eachAsync_","feature","name","depends","_dependsOn","requiredPackages","packages","pkg","addPackage_","features","enabled","length"],"mappings":";;;;+BAmDA;;;eAAA;;;0BAnDgC;uBACL;yEACE;;;;;;AAE7B;;;CAGC,GACD,MAAMA,yBAAyBC,yBAAgB;IAC3C,MAAMC,mBAAmBC,YAAY,EAAEC,UAAU,EAAE;QAC/C,MAAMC,MAAMC,yBAAe,CAAC,IAAI,CAACC,OAAO,CAACC,cAAc,CAAC;QAExDL,eAAe,IAAI,CAACM,aAAa,CAACN;QAElC,MAAM,IAAI,CAACO,KAAK,CAAC,YAAYN;QAC7B,IAAI,CAACO,GAAG,CAAC,WAAW,CAAC,6BAA6B,EAAEP,WAAW,mBAAmB,CAAC;QAEnF,IAAIQ,UAAU;QAEd,MAAMC,IAAAA,iBAAU,EAACV,cAAc,OAAO,CAACW,QAAQ;YAC3C,MAAM,EAAEC,IAAI,EAAEC,OAAO,EAAE,GAAGF;YAC1B,MAAM,IAAI,CAACJ,KAAK,CAAC,iBAAiBK;YAClC,IAAI,CAACJ,GAAG,CAAC,WAAW,CAAC,qCAAqC,EAAEI,KAAK,KAAK,CAAC;YAEvEC,WAAW,IAAI,CAACC,UAAU,CAACD,SAASD;YAEpC,MAAMG,mBAAmBJ,QAAQK,QAAQ,IAAI,EAAE;YAC/C,MAAMN,IAAAA,iBAAU,EAACK,kBAAkBE,CAAAA,MAAOf,IAAIgB,WAAW,CAACD;YAE1D,IAAI,CAACE,QAAQ,CAACP,KAAK,CAACQ,OAAO,GAAG;YAC9B,IAAIL,iBAAiBM,MAAM,GAAG,GAAG;gBAC7B,IAAI,CAACb,GAAG,CAAC,WAAW,CAAC,yBAAyB,EAAEI,KAAK,kBAAkB,EAAEG,iBAAiBM,MAAM,CAAC,CAAC,CAAC;YACvG,OAAO;gBACH,IAAI,CAACb,GAAG,CAAC,WAAW,CAAC,mCAAmC,EAAEI,KAAK,SAAS,CAAC;YAC7E;YAEA,MAAM,IAAI,CAACL,KAAK,CAAC,gBAAgBK;YAEjCH,WAAWM,iBAAiBM,MAAM;QACtC;QAEA,IAAIZ,UAAU,GAAG;YACb,IAAI,CAACD,GAAG,CAAC,WAAW,CAAC,2CAA2C,EAAEP,WAAW,kBAAkB,EAAEQ,QAAQ,CAAC,CAAC;QAC/G,OAAO;YACH,IAAI,CAACD,GAAG,CAAC,WAAW,CAAC,2BAA2B,EAAEP,WAAW,uBAAuB,CAAC;QACzF;QAEA,MAAM,IAAI,CAACM,KAAK,CAAC,WAAWN;IAChC;AACJ;MAEA,WAAeJ"}