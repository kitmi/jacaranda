{"version":3,"sources":["../../src/serverFeatures/engine.js"],"sourcesContent":["import Feature from '../Feature';\nimport { isEmpty } from '@kitmi/utils';\n\nexport default {\n    stage: Feature.INIT,\n\n    packages: (server, { type }) => {\n        const Engine = server.requireModule(`@kitmi/adapters::${type}`);\n        return Engine.packages;\n    },\n\n    load_: async function (server, options, name) {\n        const { type, middlewares, ..._options } = server.featureConfig(\n            options,\n            {\n                schema: {\n                    type: { type: 'text' },\n                    middlewares: [\n                        { type: 'text', optional: true },\n                        { type: 'array', optional: true },\n                        { type: 'object', optional: true },\n                    ],\n                },\n                keepUnsanitized: true,\n            },\n            name\n        );\n\n        const Engine = server.requireModule(`@kitmi/adapters::${type}`);\n\n        server.engine = new Engine(server);\n        if (!isEmpty(middlewares)) {\n            server.once('before:Plugins', async () => {\n                await server.useMiddlewares_(server.engine, middlewares);\n            });\n        }\n\n        await server.engine.init_(_options);\n    },\n};\n"],"names":["stage","Feature","INIT","packages","server","type","Engine","requireModule","load_","options","name","middlewares","_options","featureConfig","schema","optional","keepUnsanitized","engine","isEmpty","once","useMiddlewares_","init_"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAGA;;;eAAA;;;gEAHoB;uBACI;;;;;;MAExB,WAAe;IACXA,OAAOC,gBAAO,CAACC,IAAI;IAEnBC,UAAU,CAACC,QAAQ,EAAEC,IAAI,EAAE;QACvB,MAAMC,SAASF,OAAOG,aAAa,CAAC,CAAC,iBAAiB,EAAEF,KAAK,CAAC;QAC9D,OAAOC,OAAOH,QAAQ;IAC1B;IAEAK,OAAO,eAAgBJ,MAAM,EAAEK,OAAO,EAAEC,IAAI;QACxC,MAAM,EAAEL,IAAI,EAAEM,WAAW,EAAE,GAAGC,UAAU,GAAGR,OAAOS,aAAa,CAC3DJ,SACA;YACIK,QAAQ;gBACJT,MAAM;oBAAEA,MAAM;gBAAO;gBACrBM,aAAa;oBACT;wBAAEN,MAAM;wBAAQU,UAAU;oBAAK;oBAC/B;wBAAEV,MAAM;wBAASU,UAAU;oBAAK;oBAChC;wBAAEV,MAAM;wBAAUU,UAAU;oBAAK;iBACpC;YACL;YACAC,iBAAiB;QACrB,GACAN;QAGJ,MAAMJ,SAASF,OAAOG,aAAa,CAAC,CAAC,iBAAiB,EAAEF,KAAK,CAAC;QAE9DD,OAAOa,MAAM,GAAG,IAAIX,OAAOF;QAC3B,IAAI,CAACc,IAAAA,cAAO,EAACP,cAAc;YACvBP,OAAOe,IAAI,CAAC,kBAAkB;gBAC1B,MAAMf,OAAOgB,eAAe,CAAChB,OAAOa,MAAM,EAAEN;YAChD;QACJ;QAEA,MAAMP,OAAOa,MAAM,CAACI,KAAK,CAACT;IAC9B;AACJ"}