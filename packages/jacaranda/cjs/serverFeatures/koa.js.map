{"version":3,"sources":["../../src/serverFeatures/koa.js"],"sourcesContent":["import Feature from '../Feature';\n\nexport default {\n    stage: Feature.INIT,\n\n    packages: ['koa', 'koa-mount', '@koa/router', 'koa-body', 'koa-compress', 'koa-etag', 'koa-static'],\n\n    load_: async function (server, options, name) {\n        options = server.featureConfig(\n            options ?? {},\n            {\n                schema: {\n                    trustProxy: { type: 'boolean', optional: true },\n                    subdomainOffset: { type: 'integer', optional: true, post: [['~min', 2]] },\n                    port: { type: 'integer', optional: true, default: 2331 },\n                    keys: [\n                        {\n                            type: 'text',\n                        },\n                        {\n                            type: 'array',\n                            optional: true,\n                            element: { type: 'text' },\n                            post: [['~minLength', 1]],\n                        },\n                    ],\n                },\n            },\n            name\n        );\n\n        const { koa: KoaEngine } = server.tryRequire('@kitmi/adapters');\n\n        server.addMiddlewaresRegistry({\n            'koa-body': 'koa-body',\n            'koa-compress': 'koa-compress',\n            'koa-etag': 'koa-etag',\n        });\n\n        server.engine = new KoaEngine(server);\n        await server.engine.init_(options);\n    },\n};\n"],"names":["stage","Feature","INIT","packages","load_","server","options","name","featureConfig","schema","trustProxy","type","optional","subdomainOffset","post","port","default","keys","element","koa","KoaEngine","tryRequire","addMiddlewaresRegistry","engine","init_"],"mappings":";;;;+BAEA;;;eAAA;;;gEAFoB;;;;;;MAEpB,WAAe;IACXA,OAAOC,gBAAO,CAACC,IAAI;IAEnBC,UAAU;QAAC;QAAO;QAAa;QAAe;QAAY;QAAgB;QAAY;KAAa;IAEnGC,OAAO,eAAgBC,MAAM,EAAEC,OAAO,EAAEC,IAAI;QACxCD,UAAUD,OAAOG,aAAa,CAC1BF,WAAW,CAAC,GACZ;YACIG,QAAQ;gBACJC,YAAY;oBAAEC,MAAM;oBAAWC,UAAU;gBAAK;gBAC9CC,iBAAiB;oBAAEF,MAAM;oBAAWC,UAAU;oBAAME,MAAM;wBAAC;4BAAC;4BAAQ;yBAAE;qBAAC;gBAAC;gBACxEC,MAAM;oBAAEJ,MAAM;oBAAWC,UAAU;oBAAMI,SAAS;gBAAK;gBACvDC,MAAM;oBACF;wBACIN,MAAM;oBACV;oBACA;wBACIA,MAAM;wBACNC,UAAU;wBACVM,SAAS;4BAAEP,MAAM;wBAAO;wBACxBG,MAAM;4BAAC;gCAAC;gCAAc;6BAAE;yBAAC;oBAC7B;iBACH;YACL;QACJ,GACAP;QAGJ,MAAM,EAAEY,KAAKC,SAAS,EAAE,GAAGf,OAAOgB,UAAU,CAAC;QAE7ChB,OAAOiB,sBAAsB,CAAC;YAC1B,YAAY;YACZ,gBAAgB;YAChB,YAAY;QAChB;QAEAjB,OAAOkB,MAAM,GAAG,IAAIH,UAAUf;QAC9B,MAAMA,OAAOkB,MAAM,CAACC,KAAK,CAAClB;IAC9B;AACJ"}