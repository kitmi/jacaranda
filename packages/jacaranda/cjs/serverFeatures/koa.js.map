{"version":3,"sources":["../../src/serverFeatures/koa.js"],"sourcesContent":["import Feature from '../Feature';\n\nexport default {\n    stage: Feature.INIT,\n\n    packages: ['koa', 'koa-mount', '@koa/router'],\n\n    load_: async function (server, options, name) {\n        options = server.featureConfig(\n            options ?? {},\n            {\n                schema: {\n                    subdomainOffset: { type: 'integer', optional: true, mod: [['~min', 2]] },\n                    httpPort: { type: 'integer', optional: true, default: 2331 },\n                    keys: [{\n                        type: 'text'\n                    },{\n                        type: 'array',\n                        optional: true,\n                        elementSchema: { type: 'text' },\n                        mod: [['~minLength', 1]],\n                    }]\n                }\n            },\n            name\n        );\n\n        const { koa: KoaEngine } = app.tryRequire('@kitmi/adapters');\n\n        server.engine = new KoaEngine(server);\n        await server.engine.init_(options);      \n    },\n};\n"],"names":["stage","Feature","INIT","packages","load_","server","options","name","featureConfig","schema","subdomainOffset","type","optional","mod","httpPort","default","keys","elementSchema","koa","KoaEngine","app","tryRequire","engine","init_"],"mappings":";;;;+BAEA;;;eAAA;;;gEAFoB;;;;;;MAEpB,WAAe;IACXA,OAAOC,gBAAO,CAACC,IAAI;IAEnBC,UAAU;QAAC;QAAO;QAAa;KAAc;IAE7CC,OAAO,eAAgBC,MAAM,EAAEC,OAAO,EAAEC,IAAI;QACxCD,UAAUD,OAAOG,aAAa,CAC1BF,WAAW,CAAC,GACZ;YACIG,QAAQ;gBACJC,iBAAiB;oBAAEC,MAAM;oBAAWC,UAAU;oBAAMC,KAAK;wBAAC;4BAAC;4BAAQ;yBAAE;qBAAC;gBAAC;gBACvEC,UAAU;oBAAEH,MAAM;oBAAWC,UAAU;oBAAMG,SAAS;gBAAK;gBAC3DC,MAAM;oBAAC;wBACHL,MAAM;oBACV;oBAAE;wBACEA,MAAM;wBACNC,UAAU;wBACVK,eAAe;4BAAEN,MAAM;wBAAO;wBAC9BE,KAAK;4BAAC;gCAAC;gCAAc;6BAAE;yBAAC;oBAC5B;iBAAE;YACN;QACJ,GACAN;QAGJ,MAAM,EAAEW,KAAKC,SAAS,EAAE,GAAGC,IAAIC,UAAU,CAAC;QAE1ChB,OAAOiB,MAAM,GAAG,IAAIH,UAAUd;QAC9B,MAAMA,OAAOiB,MAAM,CAACC,KAAK,CAACjB;IAC9B;AACJ"}