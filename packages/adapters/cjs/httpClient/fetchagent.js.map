{"version":3,"sources":["../../src/httpClient/fetchagent.js"],"sourcesContent":["import ResponseWrapper, { isJSON } from '../helpers/superagentLike';\nimport { appendQuery } from '@kitmi/utils';\n\nconst fetchAdapter = () => {\n    return {\n        createRequest(method, url, _options) {\n            const headers = {\n                'content-type': 'application/json',\n            };\n\n            let query;\n\n            const options = {\n                redirect: \"follow\", // manual, *follow, error\n            };\n\n            const requestWrapper = {\n                set: (name, value) => {\n                    let lowerName = name.toLowerCase();\n                    if (lowerName === 'type') {\n                        lowerName = 'content-type';\n                    }\n                    headers[lowerName] = value;\n                    return requestWrapper;\n                },\n                withCredentials: () => {\n                    options.mode = 'cors';\n                    options.credentials = 'include';\n                    return requestWrapper;\n                },\n                send: (body) => {\n                    if (isJSON(headers['content-type'])) {\n                        options.body = JSON.stringify(body);\n                    } else {\n                        options.body = body;\n                    }\n                    return requestWrapper;\n                },\n                query: (_query) => {\n                    query = query;\n                    return requestWrapper;\n                },\n                type: (type) => {\n                    headers['content-type'] = type;\n                    return requestWrapper;\n                },\n                accept: (type) => {\n                    headers.accept = type.includes('/') ? type : `application/${type}`;\n                    return requestWrapper;\n                },\n                then: async (callback) => {\n                    if (_options._method === 'download' && !headers.accept) {\n                        requestWrapper.accept('octet-stream');\n                    }\n\n                    const __method = method.toUpperCase();\n\n                    const response = await fetch(query ? appendQuery(url, query) : url, {\n                        ...options,\n                        method: __method, // *GET, POST, PUT, DELETE, etc.\n                        headers,\n                    });                                      \n                    \n                    return ResponseWrapper.create_({ headers, method: __method, url }, response).then(callback);\n                }\n            };\n\n            return requestWrapper;\n        },\n    };\n};\n\nexport default fetchAdapter;\n"],"names":["fetchAdapter","createRequest","method","url","_options","headers","query","options","redirect","requestWrapper","set","name","value","lowerName","toLowerCase","withCredentials","mode","credentials","send","body","isJSON","JSON","stringify","_query","type","accept","includes","then","callback","_method","__method","toUpperCase","response","fetch","appendQuery","ResponseWrapper","create_"],"mappings":";;;;+BAwEA;;;eAAA;;;wEAxEwC;uBACZ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE5B,MAAMA,eAAe;IACjB,OAAO;QACHC,eAAcC,MAAM,EAAEC,GAAG,EAAEC,QAAQ;YAC/B,MAAMC,UAAU;gBACZ,gBAAgB;YACpB;YAEA,IAAIC;YAEJ,MAAMC,UAAU;gBACZC,UAAU;YACd;YAEA,MAAMC,iBAAiB;gBACnBC,KAAK,CAACC,MAAMC;oBACR,IAAIC,YAAYF,KAAKG,WAAW;oBAChC,IAAID,cAAc,QAAQ;wBACtBA,YAAY;oBAChB;oBACAR,OAAO,CAACQ,UAAU,GAAGD;oBACrB,OAAOH;gBACX;gBACAM,iBAAiB;oBACbR,QAAQS,IAAI,GAAG;oBACfT,QAAQU,WAAW,GAAG;oBACtB,OAAOR;gBACX;gBACAS,MAAM,CAACC;oBACH,IAAIC,IAAAA,sBAAM,EAACf,OAAO,CAAC,eAAe,GAAG;wBACjCE,QAAQY,IAAI,GAAGE,KAAKC,SAAS,CAACH;oBAClC,OAAO;wBACHZ,QAAQY,IAAI,GAAGA;oBACnB;oBACA,OAAOV;gBACX;gBACAH,OAAO,CAACiB;oBACJjB,QAAQA;oBACR,OAAOG;gBACX;gBACAe,MAAM,CAACA;oBACHnB,OAAO,CAAC,eAAe,GAAGmB;oBAC1B,OAAOf;gBACX;gBACAgB,QAAQ,CAACD;oBACLnB,QAAQoB,MAAM,GAAGD,KAAKE,QAAQ,CAAC,OAAOF,OAAO,CAAC,YAAY,EAAEA,KAAK,CAAC;oBAClE,OAAOf;gBACX;gBACAkB,MAAM,OAAOC;oBACT,IAAIxB,SAASyB,OAAO,KAAK,cAAc,CAACxB,QAAQoB,MAAM,EAAE;wBACpDhB,eAAegB,MAAM,CAAC;oBAC1B;oBAEA,MAAMK,WAAW5B,OAAO6B,WAAW;oBAEnC,MAAMC,WAAW,MAAMC,MAAM3B,QAAQ4B,IAAAA,kBAAW,EAAC/B,KAAKG,SAASH,KAAK;wBAChE,GAAGI,OAAO;wBACVL,QAAQ4B;wBACRzB;oBACJ;oBAEA,OAAO8B,uBAAe,CAACC,OAAO,CAAC;wBAAE/B;wBAASH,QAAQ4B;wBAAU3B;oBAAI,GAAG6B,UAAUL,IAAI,CAACC;gBACtF;YACJ;YAEA,OAAOnB;QACX;IACJ;AACJ;MAEA,WAAeT"}