{"version":3,"sources":["../../src/entityFeatures/stateTracking.js"],"sourcesContent":["const Rules = require('../enum/Rules');\nconst Generators = require('../Generators');\nconst { isPlainObject } = require('@genx/july');\n\n/**\n * A rule specifies the change of state will be tracked automatically.\n * @module EntityFeatureRuntime_StateTracking\n */\n\nmodule.exports = {\n    [Rules.RULE_AFTER_VALIDATION]: (feature, entityModel, context) => {\n        feature.forEach((featureItem) => {\n            if (featureItem.field in context.latest) {\n                const targetState = context.latest[featureItem.field];\n\n                if (isPlainObject(targetState) && targetState.$xr) {\n                    return;\n                }\n\n                const timestampFieldName = featureItem.stateMapping[targetState];\n                if (!timestampFieldName) {\n                    throw new Error(\n                        `State \"${targetState}\" is not one of the pre-defined states of field \"${featureItem.field}\" of entity \"${entityModel.meta.name}\".`\n                    );\n                }\n\n                if (context.latest[timestampFieldName] == null) {\n                    context.latest[timestampFieldName] = Generators.default(\n                        entityModel.meta.fields[timestampFieldName],\n                        context.i18n\n                    );\n                }\n            }\n        });\n\n        return true;\n    },\n};\n"],"names":["Rules","require","Generators","isPlainObject","module","exports","RULE_AFTER_VALIDATION","feature","entityModel","context","forEach","featureItem","field","latest","targetState","$xr","timestampFieldName","stateMapping","Error","meta","name","default","fields","i18n"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";AAAA,MAAMA,QAAQC,QAAQ;AACtB,MAAMC,aAAaD,QAAQ;AAC3B,MAAM,EAAEE,aAAa,EAAE,GAAGF,QAAQ;AAElC;;;CAGC,GAEDG,OAAOC,OAAO,GAAG;IACb,CAACL,MAAMM,qBAAqB,CAAC,EAAE,CAACC,SAASC,aAAaC;QAClDF,QAAQG,OAAO,CAAC,CAACC;YACb,IAAIA,YAAYC,KAAK,IAAIH,QAAQI,MAAM,EAAE;gBACrC,MAAMC,cAAcL,QAAQI,MAAM,CAACF,YAAYC,KAAK,CAAC;gBAErD,IAAIT,cAAcW,gBAAgBA,YAAYC,GAAG,EAAE;oBAC/C;gBACJ;gBAEA,MAAMC,qBAAqBL,YAAYM,YAAY,CAACH,YAAY;gBAChE,IAAI,CAACE,oBAAoB;oBACrB,MAAM,IAAIE,MACN,CAAC,OAAO,EAAEJ,YAAY,iDAAiD,EAAEH,YAAYC,KAAK,CAAC,aAAa,EAAEJ,YAAYW,IAAI,CAACC,IAAI,CAAC,EAAE,CAAC;gBAE3I;gBAEA,IAAIX,QAAQI,MAAM,CAACG,mBAAmB,IAAI,MAAM;oBAC5CP,QAAQI,MAAM,CAACG,mBAAmB,GAAGd,WAAWmB,OAAO,CACnDb,YAAYW,IAAI,CAACG,MAAM,CAACN,mBAAmB,EAC3CP,QAAQc,IAAI;gBAEpB;YACJ;QACJ;QAEA,OAAO;IACX;AACJ"}