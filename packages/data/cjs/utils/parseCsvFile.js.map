{"version":3,"sources":["../../src/utils/parseCsvFile.js"],"sourcesContent":["const { fs, tryRequire } = require('@genx/sys');\n\nmodule.exports = async (csvFile, options, transformer) => {\n    const csv = tryRequire('fast-csv');\n\n    const readStream = fs.createReadStream(csvFile);\n    const parser = csv.parse({\n        headers: true,\n        trim: true,\n        ...options,\n    });\n\n    let transformWithCallback, output;\n\n    if (transformer) {\n        let line = 0;\n        transformWithCallback = (data, callback) =>\n            transformer(data, line++)\n                .then((result) => callback(null, result))\n                .catch((error) => callback(error));\n    } else {\n        output = [];\n    }\n\n    return new Promise((resolve, reject) => {\n        if (!transformWithCallback) {\n            readStream.pipe(\n                parser\n                    .on('error', reject)\n                    .on('data', (record) => output.push(record))\n                    .on('end', () => resolve(output))\n            );\n        } else {\n            readStream.pipe(\n                parser\n                    .transform(transformWithCallback)\n                    .on('error', reject)\n                    .on('data', (row) => {})\n                    .on('end', () => resolve())\n            );\n        }\n    });\n};\n"],"names":["fs","tryRequire","require","module","exports","csvFile","options","transformer","csv","readStream","createReadStream","parser","parse","headers","trim","transformWithCallback","output","line","data","callback","then","result","catch","error","Promise","resolve","reject","pipe","on","record","push","transform","row"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;","mappings":";AAAA,MAAM,EAAEA,EAAE,EAAEC,UAAU,EAAE,GAAGC,QAAQ;AAEnCC,OAAOC,OAAO,GAAG,OAAOC,SAASC,SAASC;IACtC,MAAMC,MAAMP,WAAW;IAEvB,MAAMQ,aAAaT,GAAGU,gBAAgB,CAACL;IACvC,MAAMM,SAASH,IAAII,KAAK,CAAC;QACrBC,SAAS;QACTC,MAAM;QACN,GAAGR,OAAO;IACd;IAEA,IAAIS,uBAAuBC;IAE3B,IAAIT,aAAa;QACb,IAAIU,OAAO;QACXF,wBAAwB,CAACG,MAAMC,WAC3BZ,YAAYW,MAAMD,QACbG,IAAI,CAAC,CAACC,SAAWF,SAAS,MAAME,SAChCC,KAAK,CAAC,CAACC,QAAUJ,SAASI;IACvC,OAAO;QACHP,SAAS,EAAE;IACf;IAEA,OAAO,IAAIQ,QAAQ,CAACC,SAASC;QACzB,IAAI,CAACX,uBAAuB;YACxBN,WAAWkB,IAAI,CACXhB,OACKiB,EAAE,CAAC,SAASF,QACZE,EAAE,CAAC,QAAQ,CAACC,SAAWb,OAAOc,IAAI,CAACD,SACnCD,EAAE,CAAC,OAAO,IAAMH,QAAQT;QAErC,OAAO;YACHP,WAAWkB,IAAI,CACXhB,OACKoB,SAAS,CAAChB,uBACVa,EAAE,CAAC,SAASF,QACZE,EAAE,CAAC,QAAQ,CAACI,OAAS,GACrBJ,EAAE,CAAC,OAAO,IAAMH;QAE7B;IACJ;AACJ"}