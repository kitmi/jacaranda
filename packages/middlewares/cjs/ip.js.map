{"version":3,"sources":["../src/ip.js"],"sourcesContent":["import requestIp from 'request-ip';\n\nconst IPV4_PREFIX = '::ffff:';\nconst IPV4_LOCALHOST = '::1';\n\nconst ip = async (options, app) => {\n    return async (ctx, next) => {\n        let ip = requestIp.getClientIp(ctx.req);\n\n        if (ip.startsWith(IPV4_PREFIX)) {\n            ip = ip.substring(IPV4_PREFIX.length);\n        }\n\n        if (ip === IPV4_LOCALHOST) {\n            ip = '127.0.0.1';\n        }\n\n        ctx.request.ip = ip;\n        ctx.req.info = { remoteAddress: ip, remotePort: ctx.req.socket.remotePort };\n        return next();\n    };\n};\n\nexport default ip;\n"],"names":["IPV4_PREFIX","IPV4_LOCALHOST","ip","options","app","ctx","next","requestIp","getClientIp","req","startsWith","substring","length","request","info","remoteAddress","remotePort","socket"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAuBA;;;eAAA;;;kEAvBsB;;;;;;AAEtB,MAAMA,cAAc;AACpB,MAAMC,iBAAiB;AAEvB,MAAMC,KAAK,OAAOC,SAASC;IACvB,OAAO,OAAOC,KAAKC;QACf,IAAIJ,KAAKK,kBAAS,CAACC,WAAW,CAACH,IAAII,GAAG;QAEtC,IAAIP,GAAGQ,UAAU,CAACV,cAAc;YAC5BE,KAAKA,GAAGS,SAAS,CAACX,YAAYY,MAAM;QACxC;QAEA,IAAIV,OAAOD,gBAAgB;YACvBC,KAAK;QACT;QAEAG,IAAIQ,OAAO,CAACX,EAAE,GAAGA;QACjBG,IAAII,GAAG,CAACK,IAAI,GAAG;YAAEC,eAAeb;YAAIc,YAAYX,IAAII,GAAG,CAACQ,MAAM,CAACD,UAAU;QAAC;QAC1E,OAAOV;IACX;AACJ;MAEA,WAAeJ"}