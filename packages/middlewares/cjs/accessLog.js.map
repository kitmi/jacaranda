{"version":3,"sources":["../src/accessLog.js"],"sourcesContent":["import pinoHttp from 'pino-http';\n\n/**\n * Add access log for every http request\n * @module Middleware_AccessLog\n */\n\nexport default async (opt, app) => {\n    const { logger } = app.middlewareConfig(\n        opt ?? {},\n        {\n            schema: {\n                logger: { type: 'text', default: 'logger' },\n            },\n        },\n        'accessLog'\n    );\n\n    app.requireServices([logger]);\n\n    const pinoLogger = app.getService(logger);\n\n    const log = pinoHttp({ quietReqLogger: true, ...opt, logger: pinoLogger });\n\n    return (ctx, next) => {\n        log(ctx.req, ctx.res);\n        ctx.log = ctx.request.log = ctx.response.log = ctx.req.log;\n        return next();\n    };\n};\n"],"names":["opt","app","logger","middlewareConfig","schema","type","default","requireServices","pinoLogger","getService","log","pinoHttp","quietReqLogger","ctx","next","req","res","request","response"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAEA;;;CAGC,GAED;;;eAAA;;;iEAPqB;;;;;;MAOrB,WAAe,OAAOA,KAAKC;IACvB,MAAM,EAAEC,MAAM,EAAE,GAAGD,IAAIE,gBAAgB,CACnCH,OAAO,CAAC,GACR;QACII,QAAQ;YACJF,QAAQ;gBAAEG,MAAM;gBAAQC,SAAS;YAAS;QAC9C;IACJ,GACA;IAGJL,IAAIM,eAAe,CAAC;QAACL;KAAO;IAE5B,MAAMM,aAAaP,IAAIQ,UAAU,CAACP;IAElC,MAAMQ,MAAMC,IAAAA,iBAAQ,EAAC;QAAEC,gBAAgB;QAAM,GAAGZ,GAAG;QAAEE,QAAQM;IAAW;IAExE,OAAO,CAACK,KAAKC;QACTJ,IAAIG,IAAIE,GAAG,EAAEF,IAAIG,GAAG;QACpBH,IAAIH,GAAG,GAAGG,IAAII,OAAO,CAACP,GAAG,GAAGG,IAAIK,QAAQ,CAACR,GAAG,GAAGG,IAAIE,GAAG,CAACL,GAAG;QAC1D,OAAOI;IACX;AACJ"}