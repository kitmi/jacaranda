{"version":3,"sources":["../../src/models/ResourceGroup.js"],"names":["ValidationError","ReferencedNotExist","require","Utils","Lang","module","exports","Base","ensureGroup_","entityName","entityId","connOpts","console","log","Entity","db","model","entity","findOne_","$query","id","$association","resourceGroup","updateOne_","$retrieveUpdated","create_","$retrieveCreated","insertIgnore"],"mappings":";;;;AAAA,MAAM;AAAEA,EAAAA,eAAF;AAAmBC,EAAAA;AAAnB,IAA0CC,OAAO,CAAC,aAAD,CAAvD;;AACA,MAAM;AACFC,EAAAA,KAAK,EAAE;AAAEC,IAAAA;AAAF;AADL,IAEFF,OAAO,CAAC,YAAD,CAFX;;AAIAG,MAAM,CAACC,OAAP,GAAkBC,IAAD,IACb,cAAcA,IAAd,CAAmB;AACU,eAAZC,YAAY,CAACC,UAAD,EAAaC,QAAb,EAAuBC,QAAvB,EAAiC;AACtDC,IAAAA,OAAO,CAACC,GAAR,CAAYJ,UAAZ,EAAwBC,QAAxB;;AAEA,QAAIA,QAAJ,EAAc;AACV,YAAMI,MAAM,GAAG,KAAKC,EAAL,CAAQC,KAAR,CAAcP,UAAd,CAAf;AACA,YAAMQ,MAAM,GAAG,MAAMH,MAAM,CAACI,QAAP,CACjB;AACIC,QAAAA,MAAM,EAAE;AACJC,UAAAA,EAAE,EAAEV;AADA,SADZ;AAIIW,QAAAA,YAAY,EAAE,CAAC,eAAD;AAJlB,OADiB,EAOjBV,QAPiB,CAArB;;AAUA,UAAI,CAACM,MAAL,EAAa;AACT,cAAM,IAAIhB,kBAAJ,CAAuB,mBAAvB,EAA4C;AAC9CQ,UAAAA,UAD8C;AAE9CC,UAAAA;AAF8C,SAA5C,CAAN;AAIH;;AAED,UAAIO,MAAM,CAACK,aAAX,EAA0B;AACtB,YAAI,CAACL,MAAM,CAAC,gBAAD,CAAN,CAAyBP,QAA9B,EAAwC;AACpC,iBAAO,KAAKa,UAAL,CACH;AACIb,YAAAA;AADJ,WADG,EAIH;AACIS,YAAAA,MAAM,EAAE;AAAEC,cAAAA,EAAE,EAAEH,MAAM,CAACK;AAAb,aADZ;AAEIE,YAAAA,gBAAgB,EAAE;AAFtB,WAJG,EAQHb,QARG,CAAP;AAUH;;AAED,eAAOM,MAAM,CAAC,gBAAD,CAAb;AACH;AACJ;;AAED,WAAO,KAAKQ,OAAL,CACH;AACIhB,MAAAA,UADJ;AAEIC,MAAAA;AAFJ,KADG,EAKH;AAAEgB,MAAAA,gBAAgB,EAAE;AAApB,KALG,EAMH,EAAE,GAAGf,QAAL;AAAegB,MAAAA,YAAY,EAAE;AAA7B,KANG,CAAP;AAQH;;AAjDc,CADvB","sourcesContent":["const { ValidationError, ReferencedNotExist } = require('@genx/error');\nconst {\n    Utils: { Lang },\n} = require('@genx/data');\n\nmodule.exports = (Base) =>\n    class extends Base {\n        static async ensureGroup_(entityName, entityId, connOpts) {\n            console.log(entityName, entityId);\n\n            if (entityId) {\n                const Entity = this.db.model(entityName);\n                const entity = await Entity.findOne_(\n                    {\n                        $query: {\n                            id: entityId,\n                        },\n                        $association: ['resourceGroup'],\n                    },\n                    connOpts\n                );\n\n                if (!entity) {\n                    throw new ReferencedNotExist('Entity not found.', {\n                        entityName,\n                        entityId,\n                    });\n                }\n\n                if (entity.resourceGroup) {\n                    if (!entity[':resourceGroup'].entityId) {\n                        return this.updateOne_(\n                            {\n                                entityId,\n                            },\n                            {\n                                $query: { id: entity.resourceGroup },\n                                $retrieveUpdated: true,\n                            },\n                            connOpts\n                        );\n                    }\n\n                    return entity[':resourceGroup'];\n                }\n            }\n\n            return this.create_(\n                {\n                    entityName,\n                    entityId,\n                },\n                { $retrieveCreated: true },\n                { ...connOpts, insertIgnore: true }\n            );\n        }\n    };\n"],"file":"ResourceGroup.js"}