{"version":3,"sources":["../../../src/migration/rules/removeBackReference.js"],"sourcesContent":["const { _ } = require('@genx/july');\n\nfunction applyRule(db, Entity, entity) {\n    //remove back reference\n\n    const associations = Entity.meta.associations;\n    associations && _.forOwn(associations, (assoc, anchor) => {\n        const key = ':' + anchor;\n\n        const subEntity = entity[key];\n        if (subEntity) {\n            if (assoc.list) {\n                //array of objects\n                const SubEntity = db.model(assoc.entity);\n                subEntity.forEach(item => { \n                    delete item[assoc.field];\n                    applyRule(db, SubEntity, item); \n                });\n            } \n        } \n    });\n};\n\nmodule.exports = applyRule;"],"names":["_","require","applyRule","db","Entity","entity","associations","meta","forOwn","assoc","anchor","key","subEntity","list","SubEntity","model","forEach","item","field","module","exports"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;","mappings":";AAAA,MAAM,EAAEA,CAAC,EAAE,GAAGC,QAAQ;AAEtB,SAASC,UAAUC,EAAE,EAAEC,MAAM,EAAEC,MAAM;IACjC,uBAAuB;IAEvB,MAAMC,eAAeF,OAAOG,IAAI,CAACD,YAAY;IAC7CA,gBAAgBN,EAAEQ,MAAM,CAACF,cAAc,CAACG,OAAOC;QAC3C,MAAMC,MAAM,MAAMD;QAElB,MAAME,YAAYP,MAAM,CAACM,IAAI;QAC7B,IAAIC,WAAW;YACX,IAAIH,MAAMI,IAAI,EAAE;gBACZ,kBAAkB;gBAClB,MAAMC,YAAYX,GAAGY,KAAK,CAACN,MAAMJ,MAAM;gBACvCO,UAAUI,OAAO,CAACC,CAAAA;oBACd,OAAOA,IAAI,CAACR,MAAMS,KAAK,CAAC;oBACxBhB,UAAUC,IAAIW,WAAWG;gBAC7B;YACJ;QACJ;IACJ;AACJ;AAEAE,OAAOC,OAAO,GAAGlB"}