{"version":3,"sources":["../../../src/migration/rules/removeAutoId.js"],"sourcesContent":["const { _ } = require('@genx/july');\n\nfunction applyRule(db, Entity, entity) {\n    const associations = Entity.meta.associations;\n    associations && _.forOwn(associations, (assoc, anchor) => {\n        const key = ':' + anchor;\n\n        const subEntity = entity[key];\n        if (subEntity) {\n            if (assoc.list) {\n                //array of objects\n                const SubEntity = db.model(assoc.entity);\n                subEntity.forEach(item => applyRule(db, SubEntity, item));\n            } else {\n                //object\n                const SubEntity = db.model(assoc.entity);\n                applyRule(db, SubEntity, subEntity);\n\n                delete entity[anchor];\n            }            \n        } \n    });\n\n    const autoId = Entity.meta.features.autoId;\n\n    if (autoId) {\n        delete entity[autoId.field];\n    }\n};\n\nmodule.exports = applyRule;"],"names":["_","require","applyRule","db","Entity","entity","associations","meta","forOwn","assoc","anchor","key","subEntity","list","SubEntity","model","forEach","item","autoId","features","field","module","exports"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";AAAA,MAAM,EAAEA,CAAC,EAAE,GAAGC,QAAQ;AAEtB,SAASC,UAAUC,EAAE,EAAEC,MAAM,EAAEC,MAAM;IACjC,MAAMC,eAAeF,OAAOG,IAAI,CAACD,YAAY;IAC7CA,gBAAgBN,EAAEQ,MAAM,CAACF,cAAc,CAACG,OAAOC;QAC3C,MAAMC,MAAM,MAAMD;QAElB,MAAME,YAAYP,MAAM,CAACM,IAAI;QAC7B,IAAIC,WAAW;YACX,IAAIH,MAAMI,IAAI,EAAE;gBACZ,kBAAkB;gBAClB,MAAMC,YAAYX,GAAGY,KAAK,CAACN,MAAMJ,MAAM;gBACvCO,UAAUI,OAAO,CAACC,CAAAA,OAAQf,UAAUC,IAAIW,WAAWG;YACvD,OAAO;gBACH,QAAQ;gBACR,MAAMH,YAAYX,GAAGY,KAAK,CAACN,MAAMJ,MAAM;gBACvCH,UAAUC,IAAIW,WAAWF;gBAEzB,OAAOP,MAAM,CAACK,OAAO;YACzB;QACJ;IACJ;IAEA,MAAMQ,SAASd,OAAOG,IAAI,CAACY,QAAQ,CAACD,MAAM;IAE1C,IAAIA,QAAQ;QACR,OAAOb,MAAM,CAACa,OAAOE,KAAK,CAAC;IAC/B;AACJ;AAEAC,OAAOC,OAAO,GAAGpB"}