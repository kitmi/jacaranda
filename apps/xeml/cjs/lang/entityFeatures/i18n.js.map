{"version":3,"sources":["../../../src/lang/entityFeatures/i18n.js"],"sourcesContent":["\"use strict\";\n\nconst { _, isPlainObject } = require('@genx/july')\nconst FEATURE_NAME = 'i18n';\n\n/**\n * A rule specifies internationalization.\n * @module EntityFeature_I18n\n */\n\n/**\n * Initialize the feature\n * @param {Entity} entity - Entity to apply this feature\n * @param {object} options - Tracking field options \n * \n * 1. add locale suffix to field\n * 2. set a default locale\n * 3. if query with default locale, fallback to the field without suffix\n * \n */\nfunction feature(entity, args = []) {\n    let [ options ] = args;\n    \n    if (!options) {\n        throw new Error('Missing feature options!');\n    }\n\n    const [ field, locales ] = options;\n\n    if (!field) {\n        throw new Error('Missing field name in options!');\n    }\n\n    if (!locales) {\n        throw new Error('Missing locale mapping in options!');\n    }\n\n    if (!isPlainObject(options.locales)) {\n        throw new Error('Invalid locale mapping. Plain object expected!');\n    }\n\n    entity.addFeature(FEATURE_NAME, options, true).once('afterAddingFields', () => {\n        if (!entity.hasField(field)) {\n            throw new Error('Field \"' + field + '\" does not exist!');\n        }\n\n        let fieldInfo = entity.fields[field];\n        let suffixSet = new Set(Object.values(locales));\n\n        for (let suffix of suffixSet) {\n            if (suffix === 'default') continue;\n\n            let fieldName = options.field + '_' + suffix;\n            entity.addField(fieldName, fieldInfo);\n        }\n    });\n\n}\n\nmodule.exports = feature;"],"names":["_","isPlainObject","require","FEATURE_NAME","feature","entity","args","options","Error","field","locales","addFeature","once","hasField","fieldInfo","fields","suffixSet","Set","Object","values","suffix","fieldName","addField","module","exports"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"AAAA;AAEA,MAAM,EAAEA,CAAC,EAAEC,aAAa,EAAE,GAAGC,QAAQ;AACrC,MAAMC,eAAe;AAErB;;;CAGC,GAED;;;;;;;;;CASC,GACD,SAASC,QAAQC,MAAM,EAAEC,OAAO,EAAE;IAC9B,IAAI,CAAEC,QAAS,GAAGD;IAElB,IAAI,CAACC,SAAS;QACV,MAAM,IAAIC,MAAM;IACpB;IAEA,MAAM,CAAEC,OAAOC,QAAS,GAAGH;IAE3B,IAAI,CAACE,OAAO;QACR,MAAM,IAAID,MAAM;IACpB;IAEA,IAAI,CAACE,SAAS;QACV,MAAM,IAAIF,MAAM;IACpB;IAEA,IAAI,CAACP,cAAcM,QAAQG,OAAO,GAAG;QACjC,MAAM,IAAIF,MAAM;IACpB;IAEAH,OAAOM,UAAU,CAACR,cAAcI,SAAS,MAAMK,IAAI,CAAC,qBAAqB;QACrE,IAAI,CAACP,OAAOQ,QAAQ,CAACJ,QAAQ;YACzB,MAAM,IAAID,MAAM,YAAYC,QAAQ;QACxC;QAEA,IAAIK,YAAYT,OAAOU,MAAM,CAACN,MAAM;QACpC,IAAIO,YAAY,IAAIC,IAAIC,OAAOC,MAAM,CAACT;QAEtC,KAAK,IAAIU,UAAUJ,UAAW;YAC1B,IAAII,WAAW,WAAW;YAE1B,IAAIC,YAAYd,QAAQE,KAAK,GAAG,MAAMW;YACtCf,OAAOiB,QAAQ,CAACD,WAAWP;QAC/B;IACJ;AAEJ;AAEAS,OAAOC,OAAO,GAAGpB"}